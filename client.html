<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹Ù…ÙŠÙ„ - Pro Version V2</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Leaflet CSS & JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Leaflet Routing Machine -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />
    <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>
    
    <!-- Icons (Lucide) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts (Cairo) -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #000000;
            --accent: #2563eb;
            --danger: #ef4444;
            --sheet-bg: #ffffff;
        }

        body { 
            font-family: 'Cairo', sans-serif; 
            background-color: #f8fafc; 
            overflow: hidden; 
            touch-action: none; 
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: none; 
        }
        
        .safe-top { padding-top: max(20px, env(safe-area-inset-top)); }
        .safe-bottom { padding-bottom: max(20px, env(safe-area-inset-bottom)); }
        
        #map { width: 100%; height: 100%; z-index: 0; position: absolute; top: 0; left: 0; }
        
        /* Map UI Elements */
        .center-pin-container {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -100%);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            pointer-events: none;
            z-index: 1000;
        }
        .map-moving .center-pin-container { transform: translate(-50%, -130%) scale(1.1); }
        .pin-bubble {
            background: #222; color: #fff; padding: 6px 12px; border-radius: 20px;
            font-size: 12px; font-weight: bold; margin-bottom: 8px; white-space: nowrap;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2); opacity: 1; transition: opacity 0.2s;
        }
        .map-moving .pin-bubble { opacity: 0; }
        
        /* Bottom Sheet Styles */
        .bottom-sheet {
            position: absolute; left: 0; right: 0; bottom: 0;
            background: var(--sheet-bg);
            border-radius: 24px 24px 0 0;
            box-shadow: 0 -5px 30px rgba(0,0,0,0.15);
            transition: transform 0.4s cubic-bezier(0.32, 0.72, 0, 1);
            z-index: 2000;
            display: flex; flex-direction: column;
            max-height: 90vh;
        }
        
        .sheet-handle-bar {
            width: 100%; height: 24px; display: flex; align-items: center; justify-content: center;
            cursor: grab; flex-shrink: 0;
        }
        .sheet-handle {
            width: 40px; height: 5px; background: #e5e7eb; border-radius: 10px;
        }

        .input-box {
            background: #f3f4f6; border: 1px solid #e5e7eb; transition: 0.3s;
        }
        .input-box:focus-within {
            background: #fff; border-color: #000; box-shadow: 0 0 0 4px rgba(0,0,0,0.05);
        }
        
        /* Animations */
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .animate-slide-up { animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .animate-fade-in { animation: fadeIn 0.2s ease-out forwards; }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Pulse for searching */
        .radar-pulse {
            position: absolute; width: 100px; height: 100px; background: rgba(0,0,0,0.1);
            border-radius: 50%; animation: pulse-ring 2s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }
        @keyframes pulse-ring {
            0% { transform: scale(0.33); opacity: 1; }
            80%, 100% { transform: scale(2); opacity: 0; }
        }
    </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel" data-type="module">
    // --- Mock Data & Helpers ---
    const MOCK_DRIVERS = [
        {id: '1', name: 'Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯', phone: '0100000001', photo: 'https://placehold.co/100', rating: 4.9, car: 'ØªÙˆÙŠÙˆØªØ§ ÙƒÙˆØ±ÙˆÙ„Ø§ - ÙØ¶ÙŠ', time: '2 Ø¯Ù‚ÙŠÙ‚Ø©', price: '45'},
        {id: '2', name: 'ÙƒØ±ÙŠÙ… Ø¹Ù„ÙŠ', phone: '0100000002', photo: 'https://placehold.co/100', rating: 4.8, car: 'Ù‡ÙŠÙˆÙ†Ø¯Ø§ÙŠ Ø¥Ù„Ù†ØªØ±Ø§ - Ø£Ø¨ÙŠØ¶', time: '4 Ø¯Ù‚Ø§Ø¦Ù‚', price: '40'},
        {id: '3', name: 'Ø³ÙŠÙ Ø¹ØµØ§Ù…', phone: '0100000003', photo: 'https://placehold.co/100', rating: 5.0, car: 'ÙƒÙŠØ§ Ø³ÙŠØ±Ø§ØªÙˆ - Ø£Ø³ÙˆØ¯', time: '6 Ø¯Ù‚Ø§Ø¦Ù‚', price: '50'},
        {id: '4', name: 'Ø¹Ù…Ø± Ø­Ø³Ù†', phone: '0100000004', photo: 'https://placehold.co/100', rating: 4.7, car: 'Ù†ÙŠØ³Ø§Ù† ØµÙ†ÙŠ - Ø£Ø­Ù…Ø±', time: '8 Ø¯Ù‚Ø§Ø¦Ù‚', price: '38'},
        {id: '5', name: 'Ø®Ø§Ù„Ø¯ Ù…Ø­Ù…ÙˆØ¯', phone: '0100000005', photo: 'https://placehold.co/100', rating: 4.6, car: 'Ø´ÙŠÙØ±ÙˆÙ„ÙŠÙ‡ Ø£ÙˆØ¨ØªØ±Ø§ - Ø£Ø²Ø±Ù‚', time: '10 Ø¯Ù‚Ø§Ø¦Ù‚', price: '42'},
    ];

    const Icon = ({ name, size = 24, className, onClick }) => {
        const ref = React.useRef(null);
        React.useEffect(() => {
            if (ref.current) {
                ref.current.innerHTML = '';
                const i = document.createElement('i');
                i.setAttribute('data-lucide', name);
                i.setAttribute('class', className || '');
                ref.current.appendChild(i);
                lucide.createIcons({ root: ref.current, nameAttr: 'data-lucide', attrs: { width: size, height: size } });
            }
        }, [name, size, className]);
        return <span ref={ref} onClick={onClick} className={`flex items-center justify-center ${onClick ? 'cursor-pointer' : ''} ${className}`}></span>;
    };

    // --- Bottom Sheet Component (The "Mobile" Feel) ---
    const BottomSheet = ({ isOpen, onClose, title, children, height = "auto", className = "" }) => {
        const [isExpanded, setIsExpanded] = React.useState(false);
        const [dragStart, setDragStart] = React.useState(null);

        const handleTouchStart = (e) => setDragStart(e.touches[0].clientY);
        const handleTouchEnd = (e) => {
            if (!dragStart) return;
            const diff = e.changedTouches[0].clientY - dragStart;
            if (diff < -50) setIsExpanded(true); // Drag Up
            if (diff > 50) setIsExpanded(false); // Drag Down
            setDragStart(null);
        };

        if (!isOpen) return null;

        return (
            <div className={`bottom-sheet ${className} ${isExpanded ? 'h-[85vh]' : (height === 'auto' ? 'h-auto' : height)}`} 
                 style={{transform: isOpen ? 'translateY(0)' : 'translateY(100%)'}}>
                <div className="sheet-handle-bar" onTouchStart={handleTouchStart} onTouchEnd={handleTouchEnd} onClick={() => setIsExpanded(!isExpanded)}>
                    <div className="sheet-handle"></div>
                </div>
                {title && (
                    <div className="px-6 pb-2 border-b border-gray-100 flex justify-between items-center">
                        <h3 className="font-bold text-lg">{title}</h3>
                        {onClose && <button onClick={onClose} className="bg-gray-100 p-2 rounded-full"><Icon name="x" size={18}/></button>}
                    </div>
                )}
                <div className="flex-1 overflow-y-auto no-scrollbar p-0 relative">
                    {children}
                </div>
            </div>
        );
    };

    // --- Login Component ---
    const Login = ({ onLogin }) => {
        const [name, setName] = React.useState('');
        const [phone, setPhone] = React.useState('');
        
        const handleSubmit = () => {
            if (name.length < 3 || phone.length < 11) return alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø©');
            onLogin({ name, phone, photo: `https://placehold.co/150x150/000/FFFFFF?text=${name.charAt(0)}` });
        };

        return (
            <div className="h-screen w-full flex flex-col p-8 bg-white safe-bottom animate-fade-in">
                <div className="flex-1 flex flex-col justify-center items-center">
                    <div className="w-28 h-28 bg-black rounded-[36px] flex items-center justify-center mb-8 shadow-2xl rotate-3 ring-4 ring-gray-50">
                        <Icon name="car" size={56} className="text-white"/>
                    </div>
                    <h1 className="text-4xl font-black text-gray-900 mb-2">Ø±Ø­Ù„ØªÙŠ</h1>
                    <p className="text-gray-400 font-medium">ØªØ¬Ø±Ø¨Ø© ØªÙ†Ù‚Ù„ Ù…Ø®ØªÙ„ÙØ©.</p>
                </div>
                <div className="space-y-4">
                    <div className="input-box p-4 rounded-2xl">
                        <label className="text-xs font-bold text-gray-400 block mb-1">Ø§Ù„Ø§Ø³Ù…</label>
                        <input value={name} onChange={e=>setName(e.target.value)} className="w-full bg-transparent font-bold text-lg outline-none" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ±ÙŠÙ…" />
                    </div>
                    <div className="input-box p-4 rounded-2xl">
                        <label className="text-xs font-bold text-gray-400 block mb-1">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                        <input value={phone} onChange={e=>setPhone(e.target.value)} type="tel" maxLength="11" className="w-full bg-transparent font-bold text-lg outline-none" placeholder="01xxxxxxxxx" />
                    </div>
                    <button onClick={handleSubmit} className="w-full bg-black text-white py-4 rounded-2xl font-bold text-lg shadow-xl active:scale-95 transition">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†</button>
                </div>
            </div>
        );
    };

    // --- Main Dashboard ---
    const Dashboard = ({ client }) => {
        const [view, setView] = React.useState('HOME'); 
        const [pickup, setPickup] = React.useState(null);
        const [dropoff, setDropoff] = React.useState(null);
        
        // Map States
        const [pickerMode, setPickerMode] = React.useState('pickup');
        const [pickerAddress, setPickerAddress] = React.useState("Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹...");
        const [isMapMoving, setIsMapMoving] = React.useState(false);
        const mapRef = React.useRef(null);
        const routingRef = React.useRef(null);
        const markersRef = React.useRef({});

        // UI States
        const [driversSheetOpen, setDriversSheetOpen] = React.useState(false);
        const [tripInfo, setTripInfo] = React.useState(null);
        const [selectedDriver, setSelectedDriver] = React.useState(null);
        const [history, setHistory] = React.useState([]);
        const [showHistory, setShowHistory] = React.useState(false);
        const [isSearching, setIsSearching] = React.useState(false);

        // --- Load History ---
        React.useEffect(() => {
            const saved = localStorage.getItem('trip_history');
            if (saved) setHistory(JSON.parse(saved));
        }, []);

        const saveToHistory = (trip) => {
            const newHistory = [trip, ...history];
            setHistory(newHistory);
            localStorage.setItem('trip_history', JSON.stringify(newHistory));
        };

        // --- Map Initialization ---
        React.useEffect(() => {
            if (!mapRef.current) {
                mapRef.current = L.map('map', { zoomControl: false, attributionControl: false }).setView([30.0444, 31.2357], 15);
                L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(mapRef.current);
                
                // Get Current Location
                navigator.geolocation.getCurrentPosition(async (pos) => {
                    const { latitude, longitude } = pos.coords;
                    mapRef.current.setView([latitude, longitude], 16);
                    const addr = await getAddress(latitude, longitude);
                    setPickup({ lat: latitude, lng: longitude, address: addr });
                });

                mapRef.current.on('movestart', () => { if (view === 'MAP_PICKER') setIsMapMoving(true); });
                mapRef.current.on('moveend', async () => {
                    if (view === 'MAP_PICKER') {
                        setIsMapMoving(false);
                        const c = mapRef.current.getCenter();
                        setPickerAddress(await getAddress(c.lat, c.lng));
                    }
                });
            }
        }, []);

        const getAddress = async (lat, lng) => {
            try {
                const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&accept-language=ar`);
                const data = await res.json();
                return data.address.road || data.address.suburb || "Ù…ÙˆÙ‚Ø¹ Ù…Ø­Ø¯Ø¯";
            } catch { return "Ù…ÙˆÙ‚Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©"; }
        };

        // --- Logic Handlers ---
        const handleConfirmPicker = () => {
            const c = mapRef.current.getCenter();
            const loc = { lat: c.lat, lng: c.lng, address: pickerAddress };
            if (pickerMode === 'pickup') setPickup(loc);
            else setDropoff(loc);
            setView('HOME');
        };

        const startTripPlanning = () => {
            if (!pickup || !dropoff) return alert("Ø­Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø£ÙˆÙ„Ø§Ù‹");
            setIsSearching(true);
            
            // Draw Route
            if (routingRef.current) routingRef.current.remove();
            
            // Custom Icons
            const pIcon = L.divIcon({ className: 'bg-transparent', html: '<div class="w-4 h-4 bg-blue-500 rounded-full border-2 border-white shadow-md"></div>' });
            const dIcon = L.divIcon({ className: 'bg-transparent', html: '<div class="w-4 h-4 bg-black rounded-sm border-2 border-white shadow-md"></div>' });

            // Cleanup old markers
            if(markersRef.current.p) markersRef.current.p.remove();
            if(markersRef.current.d) markersRef.current.d.remove();

            markersRef.current.p = L.marker([pickup.lat, pickup.lng], {icon: pIcon}).addTo(mapRef.current);
            markersRef.current.d = L.marker([dropoff.lat, dropoff.lng], {icon: dIcon}).addTo(mapRef.current);

            routingRef.current = L.Routing.control({
                waypoints: [L.latLng(pickup.lat, pickup.lng), L.latLng(dropoff.lat, dropoff.lng)],
                lineOptions: { styles: [{ color: 'black', opacity: 0.8, weight: 5 }] },
                createMarker: () => null, show: false, addWaypoints: false
            }).on('routesfound', function(e) {
                const r = e.routes[0];
                setTripInfo({ dist: (r.summary.totalDistance / 1000).toFixed(1), time: Math.round(r.summary.totalTime / 60) });
                
                // Simulate searching delay
                setTimeout(() => {
                    setIsSearching(false);
                    setDriversSheetOpen(true);
                    
                    // Fit bounds padding for bottom sheet
                    mapRef.current.fitBounds(L.latLngBounds([pickup.lat, pickup.lng], [dropoff.lat, dropoff.lng]), { paddingBottomRight: [0, 300], paddingTopLeft: [0, 50] });
                }, 1500);
            }).addTo(mapRef.current);
        };

        const handleRequestRide = () => {
            if (!selectedDriver) return;
            const trip = {
                id: Date.now(),
                date: new Date().toLocaleString('ar-EG'),
                driver: selectedDriver.name,
                from: pickup.address,
                to: dropoff.address,
                price: selectedDriver.price,
                status: 'completed'
            };
            saveToHistory(trip);
            setDriversSheetOpen(false);
            setTripInfo(null);
            setDropoff(null);
            setSelectedDriver(null);
            if (routingRef.current) routingRef.current.remove();
            if (markersRef.current.d) markersRef.current.d.remove();
            alert("ØªÙ… Ø·Ù„Ø¨ Ø§Ù„Ø±Ø­Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­! ÙˆØªÙ… Ø­ÙØ¸Ù‡Ø§ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„.");
        };

        // --- Views ---

        return (
            <div className="relative h-screen w-full bg-gray-50 overflow-hidden">
                <div id="map"></div>

                {/* Top UI Elements */}
                <div className={`absolute top-0 left-0 right-0 p-4 safe-top z-10 flex justify-between items-start pointer-events-none transition-opacity ${view === 'HOME' ? 'opacity-100' : 'opacity-0'}`}>
                    <div className="bg-white/90 backdrop-blur-md p-3 rounded-full shadow-lg pointer-events-auto flex items-center gap-2 cursor-pointer" onClick={() => setShowHistory(true)}>
                        <div className="bg-black text-white p-2 rounded-full"><Icon name="clock" size={18}/></div>
                        <span className="font-bold text-sm pl-2">Ø±Ø­Ù„Ø§ØªÙŠ</span>
                    </div>
                    <div className="bg-white/90 backdrop-blur-md p-2 rounded-full shadow-lg pointer-events-auto">
                        <img src={client.photo} className="w-10 h-10 rounded-full object-cover border border-gray-200" />
                    </div>
                </div>

                {/* Main Home Controls */}
                {view === 'HOME' && !driversSheetOpen && !isSearching && (
                    <div className="absolute bottom-0 left-0 right-0 p-6 safe-bottom z-10">
                        <div className="bg-white rounded-[32px] shadow-2xl p-6 animate-slide-up">
                            <h2 className="text-2xl font-black mb-4">Ø¥Ù„Ù‰ Ø£ÙŠÙ†ØŸ</h2>
                            
                            <div className="flex flex-col gap-3">
                                <div onClick={() => { setPickerMode('pickup'); setView('MAP_PICKER'); }} 
                                     className="bg-gray-50 p-4 rounded-2xl flex items-center gap-3 cursor-pointer border border-gray-100 active:bg-gray-100 transition">
                                    <div className="w-2 h-2 bg-blue-500 rounded-full"></div>
                                    <span className="text-gray-600 font-bold truncate flex-1">{pickup ? pickup.address : "Ø­Ø¯Ø¯ Ù…ÙˆÙ‚Ø¹Ùƒ"}</span>
                                </div>
                                
                                <div onClick={() => { setPickerMode('dropoff'); setView('MAP_PICKER'); }} 
                                     className="bg-gray-50 p-4 rounded-2xl flex items-center gap-3 cursor-pointer border border-gray-100 active:bg-gray-100 transition">
                                    <div className="w-2 h-2 bg-black rounded-sm"></div>
                                    <span className={`font-bold truncate flex-1 ${dropoff ? 'text-gray-900' : 'text-gray-400'}`}>{dropoff ? dropoff.address : "ÙˆØ¬Ù‡ØªÙƒØŸ"}</span>
                                </div>
                            </div>

                            <button onClick={startTripPlanning} disabled={!pickup || !dropoff}
                                    className="w-full bg-black text-white py-4 rounded-2xl font-bold text-lg mt-4 shadow-lg active:scale-95 transition disabled:opacity-50">
                                ÙŠÙ„Ø§ Ø¨ÙŠÙ†Ø§ ğŸš€
                            </button>
                        </div>
                    </div>
                )}

                {/* Map Picker UI */}
                {view === 'MAP_PICKER' && (
                    <>
                        <div className="absolute top-4 right-4 z-20 safe-top">
                            <button onClick={() => setView('HOME')} className="bg-white p-3 rounded-full shadow-xl"><Icon name="arrow-right" size={24}/></button>
                        </div>
                        <div className={`center-pin-container ${isMapMoving ? 'map-moving' : ''}`}>
                            <div className="pin-bubble">{pickerAddress}</div>
                            <Icon name="map-pin" size={48} className={`drop-shadow-2xl ${pickerMode === 'pickup' ? 'text-blue-600 fill-white' : 'text-black fill-white'}`} />
                        </div>
                        <div className="absolute bottom-10 left-10 right-10 z-20 safe-bottom">
                            <button onClick={handleConfirmPicker} className="w-full bg-black text-white py-4 rounded-full font-bold shadow-2xl active:scale-95 transition">
                                ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹
                            </button>
                        </div>
                    </>
                )}

                {/* Searching Loader */}
                {isSearching && (
                    <div className="absolute inset-0 bg-white/50 backdrop-blur-sm z-50 flex flex-col items-center justify-center">
                        <div className="relative flex items-center justify-center mb-8">
                            <div className="radar-pulse"></div>
                            <div className="w-16 h-16 bg-black rounded-full flex items-center justify-center z-10 shadow-2xl">
                                <Icon name="search" size={32} className="text-white"/>
                            </div>
                        </div>
                        <h3 className="text-xl font-bold">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£ÙØ¶Ù„ Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†...</h3>
                        <p className="text-gray-500 mt-2">Ù„Ø­Ø¸Ø§Øª ÙˆÙ†ÙƒÙˆÙ† Ø¬Ø§Ù‡Ø²ÙŠÙ†</p>
                    </div>
                )}

                {/* Drivers Bottom Sheet */}
                <BottomSheet isOpen={driversSheetOpen} onClose={() => { setDriversSheetOpen(false); setView('HOME'); }} title={tripInfo ? `${tripInfo.dist} ÙƒÙ… â€¢ ${tripInfo.time} Ø¯Ù‚ÙŠÙ‚Ø©` : 'Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ† Ø§Ù„Ù…ØªØ§Ø­ÙŠÙ†'}>
                    <div className="p-4 pt-0">
                        {/* Selected Driver Summary (If any) */}
                        <div className="flex items-center gap-2 mb-4 overflow-x-auto no-scrollbar pb-2">
                             <span className="bg-gray-100 text-gray-600 px-3 py-1 rounded-full text-xs font-bold whitespace-nowrap">ğŸ’° Ù†Ù‚Ø¯ÙŠ</span>
                             <span className="bg-gray-100 text-gray-600 px-3 py-1 rounded-full text-xs font-bold whitespace-nowrap">âš¡ Ø³Ø±ÙŠØ¹</span>
                        </div>

                        <div className="space-y-3 pb-safe">
                            {MOCK_DRIVERS.map(driver => (
                                <div key={driver.id} 
                                     onClick={() => setSelectedDriver(driver)}
                                     className={`p-4 rounded-2xl border-2 transition cursor-pointer flex items-center gap-4 ${selectedDriver?.id === driver.id ? 'border-black bg-gray-50' : 'border-transparent bg-white shadow-sm hover:bg-gray-50'}`}>
                                    <div className="relative">
                                        <img src={driver.photo} className="w-14 h-14 rounded-full object-cover bg-gray-200"/>
                                        <div className="absolute -bottom-1 -right-1 bg-white rounded-full p-0.5"><Icon name="star" size={12} className="text-yellow-400 fill-yellow-400"/></div>
                                    </div>
                                    <div className="flex-1">
                                        <div className="flex justify-between">
                                            <h4 className="font-bold text-gray-900">{driver.car}</h4>
                                            <span className="font-black text-lg">{driver.price} Ø¬.Ù…</span>
                                        </div>
                                        <div className="flex justify-between mt-1 text-sm text-gray-500">
                                            <span>{driver.name}</span>
                                            <span>ÙŠØµÙ„ Ø®Ù„Ø§Ù„ {driver.time}</span>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                    {/* Sticky Footer Button */}
                    <div className="p-4 bg-white border-t border-gray-100 sticky bottom-0 safe-bottom">
                         <button onClick={handleRequestRide} disabled={!selectedDriver} className="w-full bg-black text-white py-4 rounded-xl font-bold text-lg shadow-xl active:scale-95 transition disabled:opacity-50">
                            {selectedDriver ? `ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø² (${selectedDriver.price} Ø¬.Ù…)` : 'Ø§Ø®ØªØ± ÙƒØ§Ø¨ØªÙ†'}
                         </button>
                    </div>
                </BottomSheet>

                {/* History Sheet */}
                <BottomSheet isOpen={showHistory} onClose={() => setShowHistory(false)} title="Ø³Ø¬Ù„ Ø±Ø­Ù„Ø§ØªÙŠ" height="70vh">
                    <div className="p-4 space-y-4 pb-10">
                        {history.length === 0 ? (
                            <div className="text-center py-10 text-gray-400">
                                <Icon name="ghost" size={48} className="mx-auto mb-4 opacity-50"/>
                                <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø­Ù„Ø§Øª Ø³Ø§Ø¨Ù‚Ø©</p>
                            </div>
                        ) : (
                            history.map(item => (
                                <div key={item.id} className="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 flex gap-4">
                                    <div className="bg-gray-100 w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0"><Icon name="check-circle" className="text-green-500"/></div>
                                    <div className="flex-1">
                                        <div className="flex justify-between items-start mb-2">
                                            <h4 className="font-bold text-sm">{item.date}</h4>
                                            <span className="text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded-full font-bold">Ù…ÙƒØªÙ…Ù„Ø©</span>
                                        </div>
                                        <div className="relative pl-4 border-r-2 border-gray-200 space-y-2 mr-1">
                                            <div className="text-xs text-gray-500 truncate">{item.from}</div>
                                            <div className="text-xs text-gray-900 font-bold truncate">{item.to}</div>
                                        </div>
                                        <div className="mt-3 flex justify-between items-center text-xs text-gray-500">
                                            <span>Ø§Ù„ÙƒØ§Ø¨ØªÙ†: {item.driver}</span>
                                            <span className="font-bold text-black">{item.price} Ø¬.Ù…</span>
                                        </div>
                                    </div>
                                </div>
                            ))
                        )}
                    </div>
                </BottomSheet>

            </div>
        );
    };

    const App = () => {
        const [clientData, setClientData] = React.useState(null);
        React.useEffect(() => { const s = localStorage.getItem('client_app_v2_pro'); if (s) setClientData(JSON.parse(s)); }, []);
        return clientData ? <Dashboard client={clientData} /> : <Login onLogin={(d) => { setClientData(d); localStorage.setItem('client_app_v2_pro', JSON.stringify(d)); }} />;
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>
</body>
</html>
